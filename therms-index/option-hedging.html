<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Option Hedging Strategies - Interactive Guide</title>
    <link rel="stylesheet" href="unified-styles.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Option Hedging Strategies</h1>
        
        <div class="intro-text">
            <p>Hedging with options provides portfolio protection while maintaining upside potential. From simple protective puts to complex delta-neutral strategies, options offer flexible risk management tools for various market conditions.</p>
        </div>

        <!-- Portfolio Hedging Calculator -->
        <div class="card">
            <h2>Portfolio Hedging Calculator</h2>
            
            <div class="input-row">
                <div class="input-group">
                    <label for="portfolioValue">Portfolio Value ($):</label>
                    <input type="number" id="portfolioValue" value="100000" step="1000" min="0">
                </div>
                <div class="input-group">
                    <label for="portfolioBeta">Portfolio Beta:</label>
                    <input type="number" id="portfolioBeta" value="1.2" step="0.1" min="0">
                </div>
                <div class="input-group">
                    <label for="indexLevel">Index Level:</label>
                    <input type="number" id="indexLevel" value="4500" step="10" min="0">
                </div>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label for="hedgeStrategy">Hedging Strategy:</label>
                    <select id="hedgeStrategy">
                        <option value="protective-put">Protective Put</option>
                        <option value="collar">Collar</option>
                        <option value="put-spread">Put Spread</option>
                        <option value="dynamic">Dynamic Delta Hedge</option>
                        <option value="vix">VIX Hedge</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="protectionLevel">Protection Level (%):</label>
                    <input type="number" id="protectionLevel" value="90" step="5" min="50" max="100">
                </div>
                <div class="input-group">
                    <label for="timeHorizon">Time Horizon (days):</label>
                    <input type="number" id="timeHorizon" value="30" step="1" min="1">
                </div>
            </div>

            <div class="input-row">
                <div class="input-group">
                    <label for="impliedVol">Implied Volatility (%):</label>
                    <input type="number" id="impliedVol" value="20" step="1" min="1">
                </div>
                <div class="input-group">
                    <label for="riskFreeRate">Risk-Free Rate (%):</label>
                    <input type="number" id="riskFreeRate" value="5" step="0.1" min="0">
                </div>
            </div>

            <button class="btn btn-primary" onclick="calculateHedge()">Calculate Hedge</button>

            <!-- Hedge Results -->
            <div class="hedge-results">
                <div class="hedge-summary card highlight">
                    <h3>Hedge Recommendation</h3>
                    <div class="hedge-metrics">
                        <div class="hedge-metric">
                            <span>Contracts Needed:</span>
                            <span id="contractsNeeded">0</span>
                        </div>
                        <div class="hedge-metric">
                            <span>Hedge Cost:</span>
                            <span id="hedgeCost">$0</span>
                        </div>
                        <div class="hedge-metric">
                            <span>Cost as % of Portfolio:</span>
                            <span id="hedgeCostPercent">0%</span>
                        </div>
                        <div class="hedge-metric">
                            <span>Maximum Loss:</span>
                            <span id="maxLoss">$0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hedge Performance Visualization -->
        <div class="card">
            <h2>Hedge Performance Analysis</h2>
            <div id="hedgePerformanceChart"></div>
            
            <div class="performance-table">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Market Move</th>
                            <th>Unhedged P&L</th>
                            <th>Hedge P&L</th>
                            <th>Net P&L</th>
                            <th>Protection %</th>
                        </tr>
                    </thead>
                    <tbody id="performanceTable">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Greeks-Based Hedging -->
        <div class="card">
            <h2>Greeks-Based Hedging</h2>
            
            <div class="greeks-hedge-grid">
                <div class="greek-hedge-card">
                    <h3>Delta Hedging</h3>
                    <p>Neutralize directional risk</p>
                    <div class="greek-value">
                        <span>Portfolio Delta:</span>
                        <span id="portfolioDelta">120,000</span>
                    </div>
                    <div class="greek-value">
                        <span>Hedge Delta Needed:</span>
                        <span id="hedgeDeltaNeeded">-120,000</span>
                    </div>
                </div>

                <div class="greek-hedge-card">
                    <h3>Gamma Hedging</h3>
                    <p>Manage convexity risk</p>
                    <div class="greek-value">
                        <span>Portfolio Gamma:</span>
                        <span id="portfolioGamma">500</span>
                    </div>
                    <div class="greek-value">
                        <span>Gamma Risk:</span>
                        <span id="gammaRisk">Moderate</span>
                    </div>
                </div>

                <div class="greek-hedge-card">
                    <h3>Vega Hedging</h3>
                    <p>Protect against volatility changes</p>
                    <div class="greek-value">
                        <span>Portfolio Vega:</span>
                        <span id="portfolioVega">5,000</span>
                    </div>
                    <div class="greek-value">
                        <span>Vol Exposure:</span>
                        <span id="volExposure">$5,000/1% vol</span>
                    </div>
                </div>
            </div>

            <button class="btn btn-secondary" onclick="calculateGreeksHedge()">Calculate Greeks Hedge</button>
        </div>

        <!-- Tail Risk Hedging -->
        <div class="card">
            <h2>Tail Risk Protection</h2>
            
            <div class="tail-risk-selector">
                <label>Select Tail Event Scenario:</label>
                <div class="scenario-buttons">
                    <button class="scenario-btn" onclick="analyzeTailRisk('moderate')">-10% Correction</button>
                    <button class="scenario-btn" onclick="analyzeTailRisk('severe')">-20% Bear Market</button>
                    <button class="scenario-btn" onclick="analyzeTailRisk('crash')">-30% Crash</button>
                    <button class="scenario-btn" onclick="analyzeTailRisk('black-swan')">Black Swan Event</button>
                </div>
            </div>

            <div id="tailRiskChart"></div>

            <div class="tail-risk-strategies">
                <div class="strategy-comparison">
                    <h3>Protection Strategies Comparison</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Strategy</th>
                                <th>Cost</th>
                                <th>Protection Level</th>
                                <th>Pros</th>
                                <th>Cons</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>OTM Puts</td>
                                <td>Low</td>
                                <td>Tail events only</td>
                                <td>Cheap, high leverage</td>
                                <td>No small move protection</td>
                            </tr>
                            <tr>
                                <td>Put Spreads</td>
                                <td>Medium</td>
                                <td>Limited range</td>
                                <td>Balanced cost/protection</td>
                                <td>Capped protection</td>
                            </tr>
                            <tr>
                                <td>VIX Calls</td>
                                <td>Low-Medium</td>
                                <td>Volatility spikes</td>
                                <td>Asymmetric payoff</td>
                                <td>Timing dependent</td>
                            </tr>
                            <tr>
                                <td>Collar</td>
                                <td>Zero/Low</td>
                                <td>Downside with cap</td>
                                <td>Costless possible</td>
                                <td>Limited upside</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Dynamic Hedging -->
        <div class="card">
            <h2>Dynamic Hedging Simulator</h2>
            
            <div class="input-row">
                <div class="input-group">
                    <label for="rebalanceFreq">Rebalance Frequency:</label>
                    <select id="rebalanceFreq">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="threshold">Threshold-Based</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="deltaThreshold">Delta Threshold:</label>
                    <input type="number" id="deltaThreshold" value="10000" step="1000">
                </div>
                <div class="input-group">
                    <label for="transactionCost">Transaction Cost (%):</label>
                    <input type="number" id="transactionCost" value="0.1" step="0.01" min="0">
                </div>
            </div>

            <button class="btn btn-secondary" onclick="simulateDynamicHedge()">Simulate Dynamic Hedge</button>

            <div id="dynamicHedgeChart"></div>
        </div>

        <!-- Educational Content -->
        <div class="card">
            <h2>Hedging Strategy Guide</h2>
            
            <div class="strategy-guide-grid">
                <div class="guide-card">
                    <h3>🛡️ Protective Put</h3>
                    <p><strong>When to Use:</strong> Bull market with crash concerns</p>
                    <p><strong>Cost:</strong> High (full premium)</p>
                    <p><strong>Protection:</strong> Complete downside</p>
                    <p><strong>Best For:</strong> Concentrated positions, pre-event protection</p>
                </div>

                <div class="guide-card">
                    <h3>📊 Collar Strategy</h3>
                    <p><strong>When to Use:</strong> Reduce hedging costs</p>
                    <p><strong>Cost:</strong> Zero to low</p>
                    <p><strong>Protection:</strong> Downside with upside cap</p>
                    <p><strong>Best For:</strong> Income generation, cost-conscious hedging</p>
                </div>

                <div class="guide-card">
                    <h3>🎯 Delta Neutral</h3>
                    <p><strong>When to Use:</strong> Market neutral positioning</p>
                    <p><strong>Cost:</strong> Variable (rebalancing)</p>
                    <p><strong>Protection:</strong> Directional neutrality</p>
                    <p><strong>Best For:</strong> Volatility trading, arbitrage</p>
                </div>

                <div class="guide-card">
                    <h3>⚡ VIX Hedging</h3>
                    <p><strong>When to Use:</strong> Systemic risk protection</p>
                    <p><strong>Cost:</strong> Moderate</p>
                    <p><strong>Protection:</strong> Volatility spike protection</p>
                    <p><strong>Best For:</strong> Portfolio insurance, tail risk</p>
                </div>
            </div>
        </div>
    </div>

    <style>
        .hedge-results {
            margin-top: 30px;
        }
        
        .hedge-summary {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            color: white;
        }
        
        .hedge-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .hedge-metric {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }
        
        .hedge-metric span:first-child {
            font-size: 0.875rem;
            margin-bottom: 5px;
            opacity: 0.9;
        }
        
        .hedge-metric span:last-child {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .greeks-hedge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .greek-hedge-card {
            background: #f7f9fc;
            padding: 20px;
            border-radius: 8px;
        }
        
        .greek-hedge-card h3 {
            margin-top: 0;
            color: #2563eb;
        }
        
        .greek-value {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .greek-value span:first-child {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .greek-value span:last-child {
            font-weight: 600;
        }
        
        .scenario-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .scenario-btn {
            padding: 10px 20px;
            background: #f7f9fc;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .scenario-btn:hover {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        
        .scenario-btn.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        
        .tail-risk-strategies {
            margin-top: 30px;
        }
        
        .strategy-comparison table {
            width: 100%;
        }
        
        .strategy-guide-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .guide-card {
            background: #f7f9fc;
            padding: 20px;
            border-radius: 8px;
        }
        
        .guide-card h3 {
            margin-top: 0;
            color: #2563eb;
        }
        
        .guide-card p {
            margin: 10px 0;
        }
        
        .performance-table {
            margin-top: 30px;
        }
    </style>

    <script>
        // Black-Scholes functions
        function normalCDF(x) {
            const a1 = 0.254829592;
            const a2 = -0.284496736;
            const a3 = 1.421413741;
            const a4 = -1.453152027;
            const a5 = 1.061405429;
            const p = 0.3275911;
            
            const sign = x < 0 ? -1 : 1;
            x = Math.abs(x) / Math.sqrt(2);
            
            const t = 1 / (1 + p * x);
            const t2 = t * t;
            const t3 = t2 * t;
            const t4 = t3 * t;
            const t5 = t4 * t;
            
            const y = 1 - ((a1 * t + a2 * t2 + a3 * t3 + a4 * t4 + a5 * t5) * Math.exp(-x * x));
            
            return 0.5 * (1 + sign * y);
        }
        
        function blackScholes(S, K, T, r, sigma, type) {
            const d1 = (Math.log(S / K) + (r + 0.5 * sigma * sigma) * T) / (sigma * Math.sqrt(T));
            const d2 = d1 - sigma * Math.sqrt(T);
            
            if (type === 'call') {
                return S * normalCDF(d1) - K * Math.exp(-r * T) * normalCDF(d2);
            } else {
                return K * Math.exp(-r * T) * normalCDF(-d2) - S * normalCDF(-d1);
            }
        }
        
        function calculateDelta(S, K, T, r, sigma, type) {
            const d1 = (Math.log(S / K) + (r + 0.5 * sigma * sigma) * T) / (sigma * Math.sqrt(T));
            return type === 'call' ? normalCDF(d1) : normalCDF(d1) - 1;
        }
        
        function calculateHedge() {
            const portfolioValue = parseFloat(document.getElementById('portfolioValue').value);
            const portfolioBeta = parseFloat(document.getElementById('portfolioBeta').value);
            const indexLevel = parseFloat(document.getElementById('indexLevel').value);
            const hedgeStrategy = document.getElementById('hedgeStrategy').value;
            const protectionLevel = parseFloat(document.getElementById('protectionLevel').value) / 100;
            const timeHorizon = parseFloat(document.getElementById('timeHorizon').value) / 365;
            const impliedVol = parseFloat(document.getElementById('impliedVol').value) / 100;
            const riskFreeRate = parseFloat(document.getElementById('riskFreeRate').value) / 100;
            
            // Calculate hedge parameters
            const notionalToHedge = portfolioValue * portfolioBeta;
            const contractMultiplier = 100;
            const strikePrice = indexLevel * protectionLevel;
            
            let contractsNeeded = 0;
            let hedgeCost = 0;
            let maxLoss = 0;
            
            if (hedgeStrategy === 'protective-put') {
                const putPrice = blackScholes(indexLevel, strikePrice, timeHorizon, riskFreeRate, impliedVol, 'put');
                const putDelta = calculateDelta(indexLevel, strikePrice, timeHorizon, riskFreeRate, impliedVol, 'put');
                contractsNeeded = Math.round(Math.abs(notionalToHedge / (indexLevel * contractMultiplier * putDelta)));
                hedgeCost = contractsNeeded * putPrice * contractMultiplier;
                maxLoss = portfolioValue * (1 - protectionLevel) + hedgeCost;
                
            } else if (hedgeStrategy === 'collar') {
                const putStrike = indexLevel * protectionLevel;
                const callStrike = indexLevel * 1.05;
                const putPrice = blackScholes(indexLevel, putStrike, timeHorizon, riskFreeRate, impliedVol, 'put');
                const callPrice = blackScholes(indexLevel, callStrike, timeHorizon, riskFreeRate, impliedVol, 'call');
                contractsNeeded = Math.round(notionalToHedge / (indexLevel * contractMultiplier));
                hedgeCost = contractsNeeded * (putPrice - callPrice) * contractMultiplier;
                maxLoss = portfolioValue * (1 - protectionLevel) + Math.max(0, hedgeCost);
                
            } else if (hedgeStrategy === 'put-spread') {
                const longPutStrike = indexLevel * protectionLevel;
                const shortPutStrike = indexLevel * (protectionLevel - 0.1);
                const longPutPrice = blackScholes(indexLevel, longPutStrike, timeHorizon, riskFreeRate, impliedVol, 'put');
                const shortPutPrice = blackScholes(indexLevel, shortPutStrike, timeHorizon, riskFreeRate, impliedVol, 'put');
                contractsNeeded = Math.round(notionalToHedge / (indexLevel * contractMultiplier));
                hedgeCost = contractsNeeded * (longPutPrice - shortPutPrice) * contractMultiplier;
                maxLoss = portfolioValue * 0.1 + hedgeCost;
            }
            
            // Update display
            document.getElementById('contractsNeeded').textContent = contractsNeeded;
            document.getElementById('hedgeCost').textContent = '$' + hedgeCost.toFixed(2);
            document.getElementById('hedgeCostPercent').textContent = ((hedgeCost / portfolioValue) * 100).toFixed(2) + '%';
            document.getElementById('maxLoss').textContent = '$' + maxLoss.toFixed(2);
            
            // Update portfolio Greeks
            const portfolioDelta = portfolioValue * portfolioBeta;
            document.getElementById('portfolioDelta').textContent = portfolioDelta.toLocaleString();
            document.getElementById('hedgeDeltaNeeded').textContent = '-' + portfolioDelta.toLocaleString();
            
            // Create performance chart
            createHedgePerformanceChart(portfolioValue, portfolioBeta, hedgeStrategy, strikePrice, indexLevel, contractsNeeded, hedgeCost);
            
            // Update performance table
            updatePerformanceTable(portfolioValue, portfolioBeta, hedgeStrategy, strikePrice, indexLevel, contractsNeeded, hedgeCost);
        }
        
        function createHedgePerformanceChart(portfolioValue, beta, strategy, strike, index, contracts, cost) {
            const marketMoves = [];
            const unhedgedPL = [];
            const hedgedPL = [];
            
            for (let move = -30; move <= 30; move += 2) {
                marketMoves.push(move);
                const portfolioPL = portfolioValue * beta * (move / 100);
                unhedgedPL.push(portfolioPL);
                
                let hedgePL = 0;
                if (strategy === 'protective-put') {
                    const newIndex = index * (1 + move / 100);
                    if (newIndex < strike) {
                        hedgePL = contracts * 100 * (strike - newIndex) - cost;
                    } else {
                        hedgePL = -cost;
                    }
                }
                
                hedgedPL.push(portfolioPL + hedgePL);
            }
            
            Plotly.newPlot('hedgePerformanceChart', [
                {
                    x: marketMoves,
                    y: unhedgedPL,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Unhedged Portfolio',
                    line: { color: '#ef4444', width: 2 }
                },
                {
                    x: marketMoves,
                    y: hedgedPL,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Hedged Portfolio',
                    line: { color: '#10b981', width: 3 }
                },
                {
                    x: [-30, 30],
                    y: [0, 0],
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Breakeven',
                    line: { color: '#6b7280', width: 1, dash: 'dash' },
                    showlegend: false
                }
            ], {
                title: 'Hedged vs Unhedged Performance',
                xaxis: { title: 'Market Move (%)' },
                yaxis: { title: 'Portfolio P&L ($)' },
                showlegend: true,
                hovermode: 'x unified'
            });
        }
        
        function updatePerformanceTable(portfolioValue, beta, strategy, strike, index, contracts, cost) {
            const moves = [-20, -10, -5, 0, 5, 10, 20];
            const tableBody = document.getElementById('performanceTable');
            tableBody.innerHTML = '';
            
            moves.forEach(move => {
                const portfolioPL = portfolioValue * beta * (move / 100);
                let hedgePL = 0;
                
                if (strategy === 'protective-put') {
                    const newIndex = index * (1 + move / 100);
                    if (newIndex < strike) {
                        hedgePL = contracts * 100 * (strike - newIndex) - cost;
                    } else {
                        hedgePL = -cost;
                    }
                }
                
                const netPL = portfolioPL + hedgePL;
                const protection = move < 0 ? Math.abs((netPL - portfolioPL) / portfolioPL * 100) : 0;
                
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td class="${move < 0 ? 'negative' : move > 0 ? 'positive' : ''}">${move > 0 ? '+' : ''}${move}%</td>
                    <td class="${portfolioPL < 0 ? 'negative' : portfolioPL > 0 ? 'positive' : ''}">$${portfolioPL.toFixed(0)}</td>
                    <td class="${hedgePL < 0 ? 'negative' : hedgePL > 0 ? 'positive' : ''}">$${hedgePL.toFixed(0)}</td>
                    <td class="${netPL < 0 ? 'negative' : netPL > 0 ? 'positive' : ''}">$${netPL.toFixed(0)}</td>
                    <td>${protection.toFixed(1)}%</td>
                `;
            });
        }
        
        function calculateGreeksHedge() {
            // Simplified Greeks calculation
            const portfolioValue = parseFloat(document.getElementById('portfolioValue').value);
            const portfolioBeta = parseFloat(document.getElementById('portfolioBeta').value);
            
            const portfolioGamma = portfolioValue * 0.005;
            const portfolioVega = portfolioValue * 0.05;
            
            document.getElementById('portfolioGamma').textContent = portfolioGamma.toLocaleString();
            document.getElementById('portfolioVega').textContent = portfolioVega.toLocaleString();
            document.getElementById('volExposure').textContent = `$${portfolioVega.toFixed(0)}/1% vol`;
        }
        
        function analyzeTailRisk(scenario) {
            // Remove active class from all buttons
            document.querySelectorAll('.scenario-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const portfolioValue = parseFloat(document.getElementById('portfolioValue').value);
            
            let scenarioData = {};
            if (scenario === 'moderate') {
                scenarioData = { drop: -10, volSpike: 5, recovery: 60 };
            } else if (scenario === 'severe') {
                scenarioData = { drop: -20, volSpike: 15, recovery: 180 };
            } else if (scenario === 'crash') {
                scenarioData = { drop: -30, volSpike: 30, recovery: 365 };
            } else if (scenario === 'black-swan') {
                scenarioData = { drop: -40, volSpike: 50, recovery: 730 };
            }
            
            // Create tail risk visualization
            const days = [];
            const portfolioValues = [];
            const hedgedValues = [];
            
            for (let day = 0; day <= 100; day++) {
                days.push(day);
                
                let value;
                if (day < 10) {
                    value = portfolioValue * (1 + scenarioData.drop / 100 * (day / 10));
                } else {
                    const recovery = (day - 10) / 90;
                    value = portfolioValue * (1 + scenarioData.drop / 100) * (1 + Math.abs(scenarioData.drop) / 100 * recovery * 0.5);
                }
                portfolioValues.push(value);
                
                // Hedged portfolio with protection
                const hedgedValue = Math.max(portfolioValue * 0.9, value);
                hedgedValues.push(hedgedValue);
            }
            
            Plotly.newPlot('tailRiskChart', [
                {
                    x: days,
                    y: portfolioValues,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Unhedged',
                    line: { color: '#ef4444', width: 2 }
                },
                {
                    x: days,
                    y: hedgedValues,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Hedged',
                    line: { color: '#10b981', width: 2 }
                },
                {
                    x: [0, 100],
                    y: [portfolioValue, portfolioValue],
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Initial Value',
                    line: { color: '#6b7280', width: 1, dash: 'dash' }
                }
            ], {
                title: `Tail Risk Scenario: ${scenario.charAt(0).toUpperCase() + scenario.slice(1)} (${scenarioData.drop}% drop)`,
                xaxis: { title: 'Days' },
                yaxis: { title: 'Portfolio Value ($)' },
                showlegend: true
            });
        }
        
        function simulateDynamicHedge() {
            const portfolioValue = parseFloat(document.getElementById('portfolioValue').value);
            const rebalanceFreq = document.getElementById('rebalanceFreq').value;
            const deltaThreshold = parseFloat(document.getElementById('deltaThreshold').value);
            const transactionCost = parseFloat(document.getElementById('transactionCost').value) / 100;
            
            // Simulate price path
            const days = 100;
            const prices = [100];
            const hedgeRatios = [];
            const costs = [];
            let totalCost = 0;
            
            for (let i = 1; i <= days; i++) {
                const return_ = (Math.random() - 0.5) * 0.04; // +/- 2% daily
                prices.push(prices[i-1] * (1 + return_));
                
                // Determine if rebalancing needed
                let shouldRebalance = false;
                if (rebalanceFreq === 'daily') {
                    shouldRebalance = true;
                } else if (rebalanceFreq === 'weekly' && i % 7 === 0) {
                    shouldRebalance = true;
                } else if (rebalanceFreq === 'threshold') {
                    const currentDelta = portfolioValue * (prices[i] / 100 - 1);
                    if (Math.abs(currentDelta) > deltaThreshold) {
                        shouldRebalance = true;
                    }
                }
                
                if (shouldRebalance) {
                    const cost = portfolioValue * transactionCost;
                    totalCost += cost;
                    costs.push(totalCost);
                } else {
                    costs.push(totalCost);
                }
                
                hedgeRatios.push(shouldRebalance ? 1 : 0);
            }
            
            // Create dynamic hedge chart
            Plotly.newPlot('dynamicHedgeChart', [
                {
                    x: Array.from({length: days + 1}, (_, i) => i),
                    y: prices,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Asset Price',
                    yaxis: 'y'
                },
                {
                    x: Array.from({length: days}, (_, i) => i + 1),
                    y: costs,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Cumulative Cost',
                    yaxis: 'y2',
                    line: { color: '#ef4444' }
                }
            ], {
                title: 'Dynamic Hedge Simulation',
                xaxis: { title: 'Days' },
                yaxis: { title: 'Asset Price', side: 'left' },
                yaxis2: { 
                    title: 'Cumulative Cost ($)', 
                    overlaying: 'y', 
                    side: 'right',
                    titlefont: { color: '#ef4444' },
                    tickfont: { color: '#ef4444' }
                },
                showlegend: true
            });
        }
        
        // Initialize on load
        calculateHedge();
    </script>
</body>
</html>