<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spread (Statistical Dispersion)</title>
  <!-- Plotly CDN -->
  <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
  <link rel="stylesheet" href="unified-styles.css">
</head>
<body>
  <a href="index.html" class="button" style="margin-bottom: 2rem;">← Back to Directory</a>
  <h2>Spread (Statistical Dispersion)</h2>

  <div class="card description">
    <h3>What is Spread?</h3>
    <p>In statistics, <strong>spread</strong> measures how much data points vary or differ from one another. Think of spread as describing whether your data points are tightly clustered together or widely scattered apart. A dataset with low spread has values that are similar to each other, while high spread indicates greater variation between values. Understanding spread helps us assess consistency, predict outcomes, and evaluate risk in fields ranging from finance to manufacturing quality control.</p>
  </div>

  <div class="formula">
    <p><strong>Common Measures of Spread:</strong></p>
    <ul>
      <li><strong>Range = Maximum - Minimum</strong></li>
      <li><strong>Interquartile Range (IQR) = Q₃ - Q₁</strong></li>
      <li><strong>Standard Deviation = √(Σ(xᵢ - μ)² / N)</strong></li>
      <li><strong>Variance = σ² = Σ(xᵢ - μ)² / N</strong></li>
      <li><strong>Coefficient of Variation = (σ / μ) × 100%</strong></li>
    </ul>
    <p>Where: <strong>xᵢ</strong> = individual values, <strong>μ</strong> = mean, <strong>σ</strong> = standard deviation, <strong>N</strong> = sample size</p>
  </div>

  <div class="scenario">
    <h3>🎯 Interactive Spread Calculator</h3>
    <p>Enter comma-separated values to calculate various measures of spread. See how different measures respond to outliers and data patterns!</p>
    
    <div class="control">
      <label for="dataInput">Enter comma-separated values:</label>
      <input type="text" id="dataInput" value="10, 12, 15, 18, 20, 22, 25, 28, 30" 
             style="width: 100%; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: var(--radius-md);">
      <small>Example: 10, 12, 15, 18, 20 or try with outliers: 10, 12, 15, 18, 100</small>
    </div>
  </div>

  <div class="highlight">
    <h3>📊 Spread Measures</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
      <div class="card">
        <h4>Range</h4>
        <p id="rangeValue" style="font-size: 1.5rem; font-weight: bold; color: var(--primary-color);">20</p>
      </div>
      <div class="card">
        <h4>Interquartile Range</h4>
        <p id="iqrValue" style="font-size: 1.5rem; font-weight: bold; color: var(--success-color);">13</p>
      </div>
      <div class="card">
        <h4>Standard Deviation</h4>
        <p id="stdDevValue" style="font-size: 1.5rem; font-weight: bold; color: var(--info-color);">6.87</p>
      </div>
      <div class="card">
        <h4>Coefficient of Variation</h4>
        <p id="cvValue" style="font-size: 1.5rem; font-weight: bold; color: var(--warning-color);">34.4%</p>
      </div>
    </div>
  </div>

  <div id="spreadVisualization" style="width:100%;height:450px;"></div>

  <div class="scenario" style="background: #fff0f0; border: 2px solid #ff6b6b;">
    <h3>⚠️ Impact of Outliers on Spread Measures</h3>
    <p>Different spread measures have varying sensitivity to outliers. Observe how each measure responds!</p>
    
    <div class="control">
      <label for="outlierValue">Add outlier value: <span id="outlierDisplay">50</span></label>
      <input type="range" id="outlierValue" min="0" max="200" step="5" value="50" />
      <div style="display: flex; gap: 1rem; margin-top: 1rem;">
        <button id="addOutlier" class="button">Add Outlier</button>
        <button id="removeOutlier" class="button" style="background-color: var(--error-color);">Remove Outlier</button>
      </div>
    </div>
    
    <div id="outlierComparison" style="margin-top: 1rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
      <div class="card">
        <h4>Range Change</h4>
        <p id="rangeChange">0</p>
      </div>
      <div class="card">
        <h4>IQR Change</h4>
        <p id="iqrChange">0</p>
      </div>
      <div class="card">
        <h4>Std Dev Change</h4>
        <p id="stdDevChange">0</p>
      </div>
      <div class="card">
        <h4>CV Change</h4>
        <p id="cvChange">0</p>
      </div>
    </div>
  </div>

  <div class="scenario">
    <h3>📈 Financial Examples</h3>
    <p>Real-world applications of spread analysis in finance:</p>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
      <div class="card">
        <h4>📊 Stock Returns</h4>
        <button class="button" onclick="loadExample('stockReturns')">Load Example</button>
        <p><small>Daily returns: volatility analysis</small></p>
      </div>
      <div class="card">
        <h4>🏦 Interest Rate Spreads</h4>
        <button class="button" onclick="loadExample('interestRates')">Load Example</button>
        <p><small>Credit risk assessment</small></p>
      </div>
      <div class="card">
        <h4>💱 Exchange Rate Volatility</h4>
        <button class="button" onclick="loadExample('exchangeRates')">Load Example</button>
        <p><small>Currency risk measurement</small></p>
      </div>
      <div class="card">
        <h4>📉 Portfolio Risk</h4>
        <button class="button" onclick="loadExample('portfolioReturns')">Load Example</button>
        <p><small>Diversification effectiveness</small></p>
      </div>
    </div>
  </div>

  <div id="distributionPlot" style="width:100%;height:400px;"></div>

  <div class="card" style="margin-top: 2rem;">
    <h3>🧮 Step-by-Step Calculation</h3>
    <div id="stepByStep">
      <p>Enter data above to see detailed calculations for each spread measure...</p>
    </div>
  </div>

  <div class="scenario">
    <h3>🔄 Distribution Shape Analysis</h3>
    <p>Generate different distribution types to see how spread measures behave:</p>
    
    <div style="display: flex; gap: 1rem; margin-top: 1rem; flex-wrap: wrap;">
      <button class="button" onclick="generateDistribution('normal')">Normal Distribution</button>
      <button class="button" onclick="generateDistribution('skewed')">Right-Skewed</button>
      <button class="button" onclick="generateDistribution('uniform')">Uniform Distribution</button>
      <button class="button" onclick="generateDistribution('bimodal')">Bimodal Distribution</button>
    </div>
    
    <div id="distributionStats" style="margin-top: 1rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
      <div class="card">
        <h4>Distribution Type</h4>
        <p id="distType" style="font-size: 1.2rem; font-weight: bold;">Custom</p>
      </div>
      <div class="card">
        <h4>Sample Size</h4>
        <p id="sampleSize" style="font-size: 1.2rem; font-weight: bold;">9</p>
      </div>
      <div class="card">
        <h4>Skewness</h4>
        <p id="skewness" style="font-size: 1.2rem; font-weight: bold;">0.00</p>
      </div>
      <div class="card">
        <h4>Kurtosis</h4>
        <p id="kurtosis" style="font-size: 1.2rem; font-weight: bold;">0.00</p>
      </div>
    </div>
  </div>

  <div class="scenario" style="background: #f0fff0; border: 2px solid #4caf50; margin-top: 2rem;">
    <h3>💡 Key Insights About Spread</h3>
    <ul style="line-height: 1.8;">
      <li><strong>Risk Assessment:</strong> Higher spread indicates greater uncertainty and potential volatility in outcomes</li>
      <li><strong>Consistency Evaluation:</strong> Low spread suggests reliable, predictable patterns in your data</li>
      <li><strong>Quality Control:</strong> Monitoring spread helps detect when processes deviate from expected norms</li>
      <li><strong>Decision Making:</strong> Understanding spread helps you gauge the reliability of predictions and estimates</li>
      <li><strong>Performance Evaluation:</strong> Spread reveals whether results are consistently good or highly variable</li>
      <li><strong>Data Interpretation:</strong> Spread tells you how representative individual data points are of the overall pattern</li>
    </ul>
  </div>

  <div class="card" style="margin-top: 2rem;">
    <h3>📊 Comparative Analysis</h3>
    <p>Compare how different spread measures rank datasets:</p>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
      <div>
        <label for="dataset1">Dataset A:</label>
        <input type="text" id="dataset1" value="1, 2, 3, 4, 5" style="width: 100%; padding: 0.5rem;">
      </div>
      <div>
        <label for="dataset2">Dataset B:</label>
        <input type="text" id="dataset2" value="0, 2.5, 5, 2.5, 0" style="width: 100%; padding: 0.5rem;">
      </div>
    </div>
    
    <div id="comparisonTable" style="margin-top: 1.5rem;">
      <table style="width: 100%;">
        <thead>
          <tr>
            <th>Measure</th>
            <th>Dataset A</th>
            <th>Dataset B</th>
            <th>Higher Spread</th>
          </tr>
        </thead>
        <tbody id="comparisonBody">
          <tr><td colspan="4">Enter datasets above to see comparison...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const dataInput = document.getElementById('dataInput');
    const outlierSlider = document.getElementById('outlierValue');
    const dataset1Input = document.getElementById('dataset1');
    const dataset2Input = document.getElementById('dataset2');
    
    let originalData = [];
    let hasOutlier = false;
    let currentOutlierValue = 50;

    // Financial example datasets
    const examples = {
      stockReturns: [-2.1, 1.5, 0.8, -0.3, 3.2, -1.7, 2.4, 0.9, -1.2, 1.8],
      interestRates: [2.5, 3.2, 2.8, 4.1, 3.9, 2.9, 3.5, 3.1, 2.7, 3.8],
      exchangeRates: [1.08, 1.12, 1.09, 1.15, 1.11, 1.07, 1.14, 1.10, 1.13, 1.06],
      portfolioReturns: [8.2, 9.1, 7.8, 8.9, 9.5, 8.1, 7.9, 9.2, 8.7, 8.4]
    };

    function parseData(input) {
      return input.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
    }

    function calculateSpreadMeasures(data) {
      if (data.length === 0) return null;
      
      const sorted = [...data].sort((a, b) => a - b);
      const n = data.length;
      const mean = data.reduce((sum, x) => sum + x, 0) / n;
      
      // Range
      const range = sorted[n - 1] - sorted[0];
      
      // IQR
      const q1Index = Math.floor(n * 0.25);
      const q3Index = Math.floor(n * 0.75);
      const q1 = sorted[q1Index];
      const q3 = sorted[q3Index];
      const iqr = q3 - q1;
      
      // Standard Deviation
      const variance = data.reduce((sum, x) => sum + Math.pow(x - mean, 2), 0) / n;
      const stdDev = Math.sqrt(variance);
      
      // Coefficient of Variation
      const cv = mean !== 0 ? (stdDev / Math.abs(mean)) * 100 : 0;
      
      // Additional statistics
      const skewness = calculateSkewness(data, mean, stdDev);
      const kurtosis = calculateKurtosis(data, mean, stdDev);
      
      return {
        range, iqr, stdDev, cv, variance, mean, 
        min: sorted[0], max: sorted[n - 1],
        q1, q3, skewness, kurtosis, n
      };
    }

    function calculateSkewness(data, mean, stdDev) {
      if (stdDev === 0) return 0;
      const n = data.length;
      const sum = data.reduce((acc, x) => acc + Math.pow((x - mean) / stdDev, 3), 0);
      return sum / n;
    }

    function calculateKurtosis(data, mean, stdDev) {
      if (stdDev === 0) return 0;
      const n = data.length;
      const sum = data.reduce((acc, x) => acc + Math.pow((x - mean) / stdDev, 4), 0);
      return (sum / n) - 3; // Excess kurtosis
    }

    function updateDisplay() {
      const rawData = parseData(dataInput.value);
      originalData = [...rawData];
      
      if (rawData.length === 0) return;

      const stats = calculateSpreadMeasures(rawData);
      if (!stats) return;
      
      // Update display
      document.getElementById('rangeValue').textContent = stats.range.toFixed(2);
      document.getElementById('iqrValue').textContent = stats.iqr.toFixed(2);
      document.getElementById('stdDevValue').textContent = stats.stdDev.toFixed(2);
      document.getElementById('cvValue').textContent = stats.cv.toFixed(1) + '%';
      
      document.getElementById('sampleSize').textContent = stats.n;
      document.getElementById('skewness').textContent = stats.skewness.toFixed(2);
      document.getElementById('kurtosis').textContent = stats.kurtosis.toFixed(2);
      
      updateOutlierComparison();
      createSpreadVisualization(rawData, stats);
      createDistributionPlot(rawData);
      updateStepByStep(rawData, stats);
      updateComparison();
    }

    function createSpreadVisualization(data, stats) {
      // Box plot
      const boxTrace = {
        y: data,
        type: 'box',
        name: 'Box Plot',
        boxpoints: 'all',
        jitter: 0.3,
        pointpos: -1.8,
        marker: { color: '#3b82f6' }
      };

      // Individual points
      const scatterTrace = {
        x: Array(data.length).fill(1.3),
        y: data,
        type: 'scatter',
        mode: 'markers',
        name: 'Data Points',
        marker: {
          size: 10,
          color: data.map(x => {
            if (x < stats.q1 - 1.5 * stats.iqr || x > stats.q3 + 1.5 * stats.iqr) {
              return '#ef4444'; // Outliers
            }
            return '#10b981'; // Normal points
          }),
          line: { width: 2, color: 'white' }
        }
      };

      const layout = {
        title: 'Spread Visualization: Box Plot with Individual Points',
        yaxis: { title: 'Value' },
        xaxis: { showticklabels: false },
        showlegend: true,
        annotations: [
          {
            x: 1.5,
            y: stats.mean,
            text: `Mean: ${stats.mean.toFixed(2)}`,
            showarrow: true,
            arrowcolor: '#f59e0b'
          }
        ]
      };

      Plotly.newPlot('spreadVisualization', [boxTrace, scatterTrace], layout, { responsive: true });
    }

    function createDistributionPlot(data) {
      const histTrace = {
        x: data,
        type: 'histogram',
        name: 'Distribution',
        marker: { color: '#3b82f6', opacity: 0.7 },
        nbinsx: Math.max(5, Math.min(15, Math.ceil(data.length / 3)))
      };

      const stats = calculateSpreadMeasures(data);
      const meanLine = {
        x: [stats.mean, stats.mean],
        y: [0, Math.max(3, Math.ceil(data.length / 4))],
        type: 'scatter',
        mode: 'lines',
        name: `Mean (${stats.mean.toFixed(2)})`,
        line: { color: '#ef4444', width: 3, dash: 'dash' }
      };

      const stdLines = {
        x: [stats.mean - stats.stdDev, stats.mean - stats.stdDev, null, 
            stats.mean + stats.stdDev, stats.mean + stats.stdDev],
        y: [0, Math.max(2, Math.ceil(data.length / 6)), null, 
            0, Math.max(2, Math.ceil(data.length / 6))],
        type: 'scatter',
        mode: 'lines',
        name: '±1 Std Dev',
        line: { color: '#10b981', width: 2, dash: 'dot' }
      };

      const layout = {
        title: 'Data Distribution with Spread Indicators',
        xaxis: { title: 'Value' },
        yaxis: { title: 'Frequency' },
        showlegend: true
      };

      Plotly.newPlot('distributionPlot', [histTrace, meanLine, stdLines], layout, { responsive: true });
    }

    function updateOutlierComparison() {
      const originalStats = calculateSpreadMeasures(originalData);
      const dataWithOutlier = hasOutlier ? [...originalData, currentOutlierValue] : originalData;
      const outlierStats = calculateSpreadMeasures(dataWithOutlier);
      
      if (!originalStats || !outlierStats) return;
      
      const rangeChange = outlierStats.range - originalStats.range;
      const iqrChange = outlierStats.iqr - originalStats.iqr;
      const stdDevChange = outlierStats.stdDev - originalStats.stdDev;
      const cvChange = outlierStats.cv - originalStats.cv;
      
      document.getElementById('rangeChange').textContent = 
        `${rangeChange >= 0 ? '+' : ''}${rangeChange.toFixed(2)}`;
      document.getElementById('iqrChange').textContent = 
        `${iqrChange >= 0 ? '+' : ''}${iqrChange.toFixed(2)}`;
      document.getElementById('stdDevChange').textContent = 
        `${stdDevChange >= 0 ? '+' : ''}${stdDevChange.toFixed(2)}`;
      document.getElementById('cvChange').textContent = 
        `${cvChange >= 0 ? '+' : ''}${cvChange.toFixed(1)}%`;
    }

    function updateStepByStep(data, stats) {
      const stepByStepDiv = document.getElementById('stepByStep');
      
      let html = `
        <div class="solution-step">
          <h4>Step 1: Sort the data</h4>
          <p>Sorted data: [${[...data].sort((a, b) => a - b).join(', ')}]</p>
        </div>
        
        <div class="solution-step">
          <h4>Step 2: Calculate Range</h4>
          <p>Range = Max - Min = ${stats.max} - ${stats.min} = <strong>${stats.range.toFixed(2)}</strong></p>
        </div>
        
        <div class="solution-step">
          <h4>Step 3: Calculate IQR</h4>
          <p>Q1 = ${stats.q1.toFixed(2)}, Q3 = ${stats.q3.toFixed(2)}</p>
          <p>IQR = Q3 - Q1 = ${stats.q3.toFixed(2)} - ${stats.q1.toFixed(2)} = <strong>${stats.iqr.toFixed(2)}</strong></p>
        </div>
        
        <div class="solution-step">
          <h4>Step 4: Calculate Standard Deviation</h4>
          <p>Mean = ${stats.mean.toFixed(2)}</p>
          <p>Variance = ${stats.variance.toFixed(2)}</p>
          <p>Standard Deviation = √${stats.variance.toFixed(2)} = <strong>${stats.stdDev.toFixed(2)}</strong></p>
        </div>
        
        <div class="solution-step">
          <h4>Step 5: Calculate Coefficient of Variation</h4>
          <p>CV = (σ / μ) × 100% = (${stats.stdDev.toFixed(2)} / ${stats.mean.toFixed(2)}) × 100% = <strong>${stats.cv.toFixed(1)}%</strong></p>
        </div>
      `;
      
      stepByStepDiv.innerHTML = html;
    }

    function updateComparison() {
      const data1 = parseData(dataset1Input.value);
      const data2 = parseData(dataset2Input.value);
      
      if (data1.length === 0 || data2.length === 0) return;
      
      const stats1 = calculateSpreadMeasures(data1);
      const stats2 = calculateSpreadMeasures(data2);
      
      const measures = [
        { name: 'Range', val1: stats1.range, val2: stats2.range },
        { name: 'IQR', val1: stats1.iqr, val2: stats2.iqr },
        { name: 'Std Dev', val1: stats1.stdDev, val2: stats2.stdDev },
        { name: 'CV (%)', val1: stats1.cv, val2: stats2.cv }
      ];
      
      let html = '';
      measures.forEach(measure => {
        const higher = measure.val1 > measure.val2 ? 'Dataset A' : 
                     measure.val2 > measure.val1 ? 'Dataset B' : 'Equal';
        html += `
          <tr>
            <td><strong>${measure.name}</strong></td>
            <td>${measure.val1.toFixed(2)}</td>
            <td>${measure.val2.toFixed(2)}</td>
            <td style="color: ${higher === 'Equal' ? 'var(--text-secondary)' : 'var(--primary-color)'};">
              <strong>${higher}</strong>
            </td>
          </tr>
        `;
      });
      
      document.getElementById('comparisonBody').innerHTML = html;
    }

    function loadExample(type) {
      const data = examples[type];
      dataInput.value = data.join(', ');
      updateDisplay();
    }

    function generateDistribution(type) {
      let data = [];
      let typeName = '';
      
      switch(type) {
        case 'normal':
          // Box-Muller transform for normal distribution
          for (let i = 0; i < 100; i++) {
            const u1 = Math.random();
            const u2 = Math.random();
            const z = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
            data.push(20 + 5 * z); // mean=20, std=5
          }
          typeName = 'Normal';
          break;
          
        case 'skewed':
          // Right-skewed distribution
          for (let i = 0; i < 100; i++) {
            const x = Math.random();
            data.push(10 + 20 * Math.pow(x, 0.5)); // Right skewed
          }
          typeName = 'Right-Skewed';
          break;
          
        case 'uniform':
          // Uniform distribution
          for (let i = 0; i < 100; i++) {
            data.push(10 + 20 * Math.random());
          }
          typeName = 'Uniform';
          break;
          
        case 'bimodal':
          // Bimodal distribution
          for (let i = 0; i < 100; i++) {
            if (Math.random() < 0.5) {
              data.push(15 + 3 * (Math.random() - 0.5));
            } else {
              data.push(25 + 3 * (Math.random() - 0.5));
            }
          }
          typeName = 'Bimodal';
          break;
      }
      
      data = data.map(x => Math.round(x * 100) / 100); // Round to 2 decimals
      dataInput.value = data.slice(0, 50).join(', '); // Show first 50 points
      document.getElementById('distType').textContent = typeName;
      updateDisplay();
    }

    // Event listeners
    dataInput.addEventListener('input', updateDisplay);
    dataset1Input.addEventListener('input', updateComparison);
    dataset2Input.addEventListener('input', updateComparison);
    
    outlierSlider.addEventListener('input', function() {
      currentOutlierValue = parseFloat(this.value);
      document.getElementById('outlierDisplay').textContent = currentOutlierValue;
      if (hasOutlier) {
        updateOutlierComparison();
      }
    });

    document.getElementById('addOutlier').addEventListener('click', function() {
      if (!hasOutlier) {
        hasOutlier = true;
        const newData = [...originalData, currentOutlierValue];
        dataInput.value = newData.join(', ');
        updateDisplay();
      }
    });

    document.getElementById('removeOutlier').addEventListener('click', function() {
      if (hasOutlier) {
        hasOutlier = false;
        dataInput.value = originalData.join(', ');
        updateDisplay();
      }
    });

    // Initialize
    updateDisplay();
  </script>
</body>
</html>