<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leverage in Derivatives - Interactive Calculator</title>
    <link rel="stylesheet" href="unified-styles.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Leverage in Derivatives</h1>
        
        <div class="intro-text">
            <p>Leverage in derivatives allows traders to control large positions with relatively small capital. While this amplifies potential returns, it equally magnifies potential losses. Understanding and managing leverage is crucial for successful derivatives trading.</p>
        </div>

        <!-- Leverage Calculator -->
        <div class="card">
            <h2>Leverage Calculator</h2>
            
            <div class="input-row">
                <div class="input-group">
                    <label for="instrumentType">Instrument Type:</label>
                    <select id="instrumentType">
                        <option value="option">Options</option>
                        <option value="future">Futures</option>
                        <option value="cfd">CFD</option>
                        <option value="forex">Forex</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="underlyingPrice">Underlying Price ($):</label>
                    <input type="number" id="underlyingPrice" value="100" step="0.01" min="0">
                </div>
            </div>

            <div class="instrument-specific" id="optionInputs">
                <div class="input-row">
                    <div class="input-group">
                        <label for="optionPremium">Option Premium ($):</label>
                        <input type="number" id="optionPremium" value="5" step="0.01" min="0">
                    </div>
                    <div class="input-group">
                        <label for="optionDelta">Delta:</label>
                        <input type="number" id="optionDelta" value="0.5" step="0.01" min="-1" max="1">
                    </div>
                    <div class="input-group">
                        <label for="optionContracts">Contracts:</label>
                        <input type="number" id="optionContracts" value="1" step="1" min="1">
                    </div>
                </div>
            </div>

            <div class="instrument-specific" id="futureInputs" style="display: none;">
                <div class="input-row">
                    <div class="input-group">
                        <label for="futureMargin">Initial Margin ($):</label>
                        <input type="number" id="futureMargin" value="5000" step="100" min="0">
                    </div>
                    <div class="input-group">
                        <label for="contractSize">Contract Size:</label>
                        <input type="number" id="contractSize" value="100" step="1" min="1">
                    </div>
                    <div class="input-group">
                        <label for="futureContracts">Contracts:</label>
                        <input type="number" id="futureContracts" value="1" step="1" min="1">
                    </div>
                </div>
            </div>

            <button class="btn btn-primary" onclick="calculateLeverage()">Calculate Leverage</button>

            <!-- Leverage Results -->
            <div class="leverage-results">
                <div class="leverage-display">
                    <h3>Leverage Ratio</h3>
                    <div class="leverage-value" id="leverageRatio">20.0x</div>
                    <div class="leverage-bar">
                        <div class="leverage-fill" id="leverageFill"></div>
                    </div>
                </div>

                <div class="metrics-row">
                    <div class="metric-card">
                        <span class="metric-label">Notional Value</span>
                        <span class="metric-value" id="notionalValue">$10,000</span>
                    </div>
                    <div class="metric-card">
                        <span class="metric-label">Capital Required</span>
                        <span class="metric-value" id="capitalRequired">$500</span>
                    </div>
                    <div class="metric-card">
                        <span class="metric-label">Effective Leverage</span>
                        <span class="metric-value" id="effectiveLeverage">10.0x</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Return Amplification -->
        <div class="card">
            <h2>Return Amplification Analysis</h2>
            
            <div class="input-row">
                <div class="input-group">
                    <label for="priceChange">Price Change (%):</label>
                    <input type="range" id="priceChange" min="-50" max="50" value="0" step="1">
                    <span id="priceChangeValue">0%</span>
                </div>
            </div>

            <div id="returnChart"></div>

            <div class="comparison-table">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Scenario</th>
                            <th>Underlying Move</th>
                            <th>Unleveraged Return</th>
                            <th>Leveraged Return</th>
                            <th>Amplification</th>
                        </tr>
                    </thead>
                    <tbody id="scenarioTable">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Risk Metrics -->
        <div class="card">
            <h2>Risk Analysis</h2>
            
            <div class="risk-grid">
                <div class="risk-card">
                    <h3>Maximum Loss</h3>
                    <div class="risk-value" id="maxLoss">$500</div>
                    <p>Total capital at risk</p>
                </div>
                <div class="risk-card">
                    <h3>Breakeven Move</h3>
                    <div class="risk-value" id="breakevenMove">5.0%</div>
                    <p>Required price move to breakeven</p>
                </div>
                <div class="risk-card">
                    <h3>Margin Call Level</h3>
                    <div class="risk-value" id="marginCall">-25%</div>
                    <p>Price move triggering margin call</p>
                </div>
                <div class="risk-card warning">
                    <h3>Risk Level</h3>
                    <div class="risk-value" id="riskLevel">MODERATE</div>
                    <p id="riskDescription">Suitable for experienced traders</p>
                </div>
            </div>
        </div>

        <!-- Margin Requirements -->
        <div class="card">
            <h2>Margin & Position Sizing</h2>
            
            <div class="input-row">
                <div class="input-group">
                    <label for="accountSize">Account Size ($):</label>
                    <input type="number" id="accountSize" value="10000" step="100" min="0">
                </div>
                <div class="input-group">
                    <label for="riskPerTrade">Risk per Trade (%):</label>
                    <input type="number" id="riskPerTrade" value="2" step="0.5" min="0" max="100">
                </div>
            </div>

            <button class="btn btn-secondary" onclick="calculatePositionSize()">Calculate Position Size</button>

            <div class="position-results" id="positionResults"></div>
        </div>

        <!-- Leverage Comparison -->
        <div class="card">
            <h2>Instrument Leverage Comparison</h2>
            
            <div id="leverageComparisonChart"></div>

            <div class="comparison-grid">
                <div class="comparison-card">
                    <h3>ðŸ“Š Stocks (Cash)</h3>
                    <p><strong>Leverage:</strong> 1:1 (No leverage)</p>
                    <p><strong>Margin:</strong> 100% required</p>
                    <p><strong>Risk:</strong> Limited to investment</p>
                </div>
                <div class="comparison-card">
                    <h3>ðŸ“ˆ Stock Options</h3>
                    <p><strong>Leverage:</strong> 10-50x typical</p>
                    <p><strong>Margin:</strong> Premium only</p>
                    <p><strong>Risk:</strong> Premium loss (buyers)</p>
                </div>
                <div class="comparison-card">
                    <h3>ðŸ“‰ Futures</h3>
                    <p><strong>Leverage:</strong> 5-20x typical</p>
                    <p><strong>Margin:</strong> 5-20% initial</p>
                    <p><strong>Risk:</strong> Unlimited potential</p>
                </div>
                <div class="comparison-card">
                    <h3>ðŸ’± Forex</h3>
                    <p><strong>Leverage:</strong> Up to 50:1 (US)</p>
                    <p><strong>Margin:</strong> 2% minimum</p>
                    <p><strong>Risk:</strong> Can exceed deposit</p>
                </div>
            </div>
        </div>

        <!-- Educational Content -->
        <div class="card">
            <h2>Understanding Leverage</h2>
            
            <div class="education-grid">
                <div class="edu-card">
                    <h3>Types of Leverage</h3>
                    <ul>
                        <li><strong>Notional Leverage:</strong> Total position value / Capital required</li>
                        <li><strong>Effective Leverage:</strong> Delta-adjusted for options</li>
                        <li><strong>Portfolio Leverage:</strong> Total exposure / Account equity</li>
                    </ul>
                </div>
                
                <div class="edu-card">
                    <h3>Leverage Benefits</h3>
                    <ul>
                        <li>Capital efficiency</li>
                        <li>Enhanced returns potential</li>
                        <li>Portfolio diversification</li>
                        <li>Hedging capabilities</li>
                    </ul>
                </div>
                
                <div class="edu-card">
                    <h3>Leverage Risks</h3>
                    <ul>
                        <li>Magnified losses</li>
                        <li>Margin calls</li>
                        <li>Forced liquidation</li>
                        <li>Gap risk</li>
                        <li>Interest costs</li>
                    </ul>
                </div>
                
                <div class="edu-card">
                    <h3>Risk Management</h3>
                    <ul>
                        <li>Position sizing rules</li>
                        <li>Stop-loss orders</li>
                        <li>Diversification</li>
                        <li>Regular monitoring</li>
                        <li>Stress testing</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <style>
        .leverage-results {
            margin-top: 30px;
        }
        
        .leverage-display {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .leverage-value {
            font-size: 3rem;
            font-weight: 700;
            margin: 20px 0;
        }
        
        .leverage-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .leverage-fill {
            height: 100%;
            background: white;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .metrics-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .metric-card {
            background: #f7f9fc;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .metric-label {
            display: block;
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 10px;
        }
        
        .metric-value {
            display: block;
            font-size: 1.5rem;
            font-weight: 600;
            color: #111827;
        }
        
        .risk-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .risk-card {
            background: #f7f9fc;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .risk-card.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        .risk-card h3 {
            margin-top: 0;
            font-size: 1rem;
            color: #6b7280;
        }
        
        .risk-card.warning h3 {
            color: white;
        }
        
        .risk-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 15px 0;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .comparison-card {
            background: #f7f9fc;
            padding: 20px;
            border-radius: 8px;
        }
        
        .comparison-card h3 {
            margin-top: 0;
            color: #2563eb;
        }
        
        .education-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .edu-card {
            background: #f7f9fc;
            padding: 20px;
            border-radius: 8px;
        }
        
        .edu-card h3 {
            margin-top: 0;
            color: #2563eb;
        }
        
        .position-results {
            margin-top: 20px;
            padding: 20px;
            background: #f7f9fc;
            border-radius: 8px;
        }
        
        .instrument-specific {
            margin: 20px 0;
        }
    </style>

    <script>
        // Handle instrument type change
        document.getElementById('instrumentType').addEventListener('change', function() {
            const type = this.value;
            document.getElementById('optionInputs').style.display = type === 'option' ? 'block' : 'none';
            document.getElementById('futureInputs').style.display = type === 'future' ? 'block' : 'none';
        });
        
        // Handle price change slider
        document.getElementById('priceChange').addEventListener('input', function() {
            document.getElementById('priceChangeValue').textContent = this.value + '%';
            updateReturnChart();
        });
        
        function calculateLeverage() {
            const instrumentType = document.getElementById('instrumentType').value;
            const underlyingPrice = parseFloat(document.getElementById('underlyingPrice').value);
            
            let notionalValue, capitalRequired, effectiveLeverage, leverageRatio;
            
            if (instrumentType === 'option') {
                const premium = parseFloat(document.getElementById('optionPremium').value);
                const delta = parseFloat(document.getElementById('optionDelta').value);
                const contracts = parseInt(document.getElementById('optionContracts').value);
                
                notionalValue = underlyingPrice * 100 * contracts;
                capitalRequired = premium * 100 * contracts;
                leverageRatio = notionalValue / capitalRequired;
                effectiveLeverage = leverageRatio * Math.abs(delta);
                
            } else if (instrumentType === 'future') {
                const margin = parseFloat(document.getElementById('futureMargin').value);
                const contractSize = parseFloat(document.getElementById('contractSize').value);
                const contracts = parseInt(document.getElementById('futureContracts').value);
                
                notionalValue = underlyingPrice * contractSize * contracts;
                capitalRequired = margin * contracts;
                leverageRatio = notionalValue / capitalRequired;
                effectiveLeverage = leverageRatio;
                
            } else if (instrumentType === 'forex') {
                // Simplified forex calculation
                leverageRatio = 50; // US max leverage
                notionalValue = underlyingPrice * 10000; // Standard lot
                capitalRequired = notionalValue / leverageRatio;
                effectiveLeverage = leverageRatio;
                
            } else if (instrumentType === 'cfd') {
                // Simplified CFD calculation
                leverageRatio = 10;
                notionalValue = underlyingPrice * 100;
                capitalRequired = notionalValue / leverageRatio;
                effectiveLeverage = leverageRatio;
            }
            
            // Update display
            document.getElementById('leverageRatio').textContent = leverageRatio.toFixed(1) + 'x';
            document.getElementById('notionalValue').textContent = '$' + notionalValue.toLocaleString();
            document.getElementById('capitalRequired').textContent = '$' + capitalRequired.toLocaleString();
            document.getElementById('effectiveLeverage').textContent = effectiveLeverage.toFixed(1) + 'x';
            
            // Update leverage bar
            const fillWidth = Math.min(100, (leverageRatio / 50) * 100);
            document.getElementById('leverageFill').style.width = fillWidth + '%';
            
            // Update risk metrics
            updateRiskMetrics(capitalRequired, leverageRatio, instrumentType);
            
            // Update return chart
            updateReturnChart();
            
            // Create comparison chart
            createLeverageComparison();
        }
        
        function updateRiskMetrics(capitalRequired, leverageRatio, instrumentType) {
            const maxLoss = capitalRequired;
            const breakevenMove = instrumentType === 'option' ? 
                (parseFloat(document.getElementById('optionPremium').value) / parseFloat(document.getElementById('underlyingPrice').value)) * 100 :
                (100 / leverageRatio);
            
            const marginCallLevel = instrumentType === 'future' ? -50 / leverageRatio : 'N/A';
            
            let riskLevel, riskDescription;
            if (leverageRatio > 20) {
                riskLevel = 'HIGH';
                riskDescription = 'Very aggressive - experts only';
            } else if (leverageRatio > 10) {
                riskLevel = 'MODERATE-HIGH';
                riskDescription = 'Suitable for experienced traders';
            } else if (leverageRatio > 5) {
                riskLevel = 'MODERATE';
                riskDescription = 'Balanced risk-reward';
            } else {
                riskLevel = 'LOW';
                riskDescription = 'Conservative approach';
            }
            
            document.getElementById('maxLoss').textContent = '$' + maxLoss.toLocaleString();
            document.getElementById('breakevenMove').textContent = breakevenMove.toFixed(1) + '%';
            document.getElementById('marginCall').textContent = marginCallLevel === 'N/A' ? marginCallLevel : marginCallLevel.toFixed(1) + '%';
            document.getElementById('riskLevel').textContent = riskLevel;
            document.getElementById('riskDescription').textContent = riskDescription;
            
            // Update risk card color
            const riskCard = document.querySelector('.risk-card.warning');
            if (leverageRatio > 20) {
                riskCard.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
            } else if (leverageRatio > 10) {
                riskCard.style.background = 'linear-gradient(135deg, #f59e0b, #d97706)';
            } else {
                riskCard.style.background = 'linear-gradient(135deg, #10b981, #059669)';
            }
        }
        
        function updateReturnChart() {
            const instrumentType = document.getElementById('instrumentType').value;
            const priceChanges = [];
            const unleveragedReturns = [];
            const leveragedReturns = [];
            
            let leverage = 1;
            if (instrumentType === 'option') {
                const underlyingPrice = parseFloat(document.getElementById('underlyingPrice').value);
                const premium = parseFloat(document.getElementById('optionPremium').value);
                const delta = parseFloat(document.getElementById('optionDelta').value);
                leverage = (underlyingPrice / premium) * Math.abs(delta);
            } else if (instrumentType === 'future') {
                const underlyingPrice = parseFloat(document.getElementById('underlyingPrice').value);
                const margin = parseFloat(document.getElementById('futureMargin').value);
                const contractSize = parseFloat(document.getElementById('contractSize').value);
                leverage = (underlyingPrice * contractSize) / margin;
            }
            
            for (let change = -30; change <= 30; change += 2) {
                priceChanges.push(change);
                unleveragedReturns.push(change);
                
                let leveragedReturn = change * leverage;
                // Cap losses at -100%
                leveragedReturn = Math.max(-100, leveragedReturn);
                leveragedReturns.push(leveragedReturn);
            }
            
            Plotly.newPlot('returnChart', [
                {
                    x: priceChanges,
                    y: unleveragedReturns,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Unleveraged',
                    line: { color: '#6b7280', width: 2 }
                },
                {
                    x: priceChanges,
                    y: leveragedReturns,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Leveraged',
                    line: { color: '#2563eb', width: 3 }
                },
                {
                    x: [-30, 30],
                    y: [0, 0],
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Breakeven',
                    line: { color: '#ef4444', width: 1, dash: 'dash' },
                    showlegend: false
                }
            ], {
                title: 'Return Amplification Effect',
                xaxis: { title: 'Underlying Price Change (%)' },
                yaxis: { title: 'Portfolio Return (%)' },
                showlegend: true,
                hovermode: 'x unified'
            });
            
            // Update scenario table
            updateScenarioTable(leverage);
        }
        
        function updateScenarioTable(leverage) {
            const scenarios = [-20, -10, -5, 5, 10, 20];
            const tableBody = document.getElementById('scenarioTable');
            tableBody.innerHTML = '';
            
            scenarios.forEach(change => {
                const unleveragedReturn = change;
                const leveragedReturn = Math.max(-100, change * leverage);
                const amplification = leverage;
                
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${change > 0 ? 'Bull' : 'Bear'} Scenario</td>
                    <td class="${change > 0 ? 'positive' : 'negative'}">${change > 0 ? '+' : ''}${change}%</td>
                    <td class="${change > 0 ? 'positive' : 'negative'}">${change > 0 ? '+' : ''}${unleveragedReturn}%</td>
                    <td class="${leveragedReturn > 0 ? 'positive' : 'negative'}">${leveragedReturn > 0 ? '+' : ''}${leveragedReturn.toFixed(1)}%</td>
                    <td>${amplification.toFixed(1)}x</td>
                `;
            });
        }
        
        function calculatePositionSize() {
            const accountSize = parseFloat(document.getElementById('accountSize').value);
            const riskPerTrade = parseFloat(document.getElementById('riskPerTrade').value) / 100;
            const instrumentType = document.getElementById('instrumentType').value;
            
            const riskAmount = accountSize * riskPerTrade;
            let results = '';
            
            if (instrumentType === 'option') {
                const premium = parseFloat(document.getElementById('optionPremium').value);
                const maxContracts = Math.floor(riskAmount / (premium * 100));
                const totalCost = maxContracts * premium * 100;
                
                results = `
                    <h3>Position Sizing Recommendation</h3>
                    <p><strong>Risk Budget:</strong> $${riskAmount.toFixed(2)} (${(riskPerTrade * 100).toFixed(1)}% of account)</p>
                    <p><strong>Maximum Contracts:</strong> ${maxContracts}</p>
                    <p><strong>Total Premium Cost:</strong> $${totalCost.toFixed(2)}</p>
                    <p><strong>Remaining Capital:</strong> $${(accountSize - totalCost).toFixed(2)}</p>
                    <div class="alert">
                        <strong>Note:</strong> This assumes maximum loss of premium for option buyers.
                    </div>
                `;
            } else if (instrumentType === 'future') {
                const margin = parseFloat(document.getElementById('futureMargin').value);
                const maxContracts = Math.floor(accountSize * 0.5 / margin); // Use 50% of account max
                const marginRequired = maxContracts * margin;
                
                results = `
                    <h3>Position Sizing Recommendation</h3>
                    <p><strong>Risk Budget:</strong> $${riskAmount.toFixed(2)} (${(riskPerTrade * 100).toFixed(1)}% of account)</p>
                    <p><strong>Maximum Contracts:</strong> ${maxContracts} (using 50% margin rule)</p>
                    <p><strong>Margin Required:</strong> $${marginRequired.toFixed(2)}</p>
                    <p><strong>Free Margin:</strong> $${(accountSize - marginRequired).toFixed(2)}</p>
                    <div class="alert warning">
                        <strong>Warning:</strong> Futures can lose more than initial margin. Use stop-losses.
                    </div>
                `;
            }
            
            document.getElementById('positionResults').innerHTML = results;
        }
        
        function createLeverageComparison() {
            const instruments = ['Stocks', 'Options', 'Futures', 'Forex', 'CFDs'];
            const typicalLeverage = [1, 20, 10, 50, 10];
            const maxLeverage = [2, 100, 20, 50, 30];
            
            Plotly.newPlot('leverageComparisonChart', [
                {
                    x: instruments,
                    y: typicalLeverage,
                    type: 'bar',
                    name: 'Typical Leverage',
                    marker: { color: '#2563eb' }
                },
                {
                    x: instruments,
                    y: maxLeverage,
                    type: 'bar',
                    name: 'Maximum Leverage',
                    marker: { color: '#ef4444' }
                }
            ], {
                title: 'Leverage by Instrument Type',
                xaxis: { title: 'Instrument' },
                yaxis: { title: 'Leverage Ratio', type: 'log' },
                barmode: 'group',
                showlegend: true
            });
        }
        
        // Initialize on load
        calculateLeverage();
    </script>
</body>
</html>