<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Standard Deviation</title>
  <!-- Plotly CDN -->
  <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
  <link rel="stylesheet" href="unified-styles.css">
</head>
<body>
  <a href="index.html" class="button" style="margin-bottom: 2rem;">← Back to Directory</a>
  <h2>Standard Deviation</h2>

  <div class="card description">
    <h3>Understanding Standard Deviation</h3>
    <p><strong>Standard deviation</strong> measures how spread out data points are from the mean. It tells us about the <em>variability</em> or <em>dispersion</em> in our dataset.</p>
    <p>A small standard deviation means data points are close to the mean (low variability), while a large standard deviation means data points are spread out (high variability).</p>
  </div>

  <div class="formula">
    <h4>Population Standard Deviation Formula:</h4>
    <p><strong>σ = √[Σ(xi - μ)² / N]</strong></p>
    <p>Where:</p>
    <ul>
      <li><strong>σ</strong> = Population standard deviation</li>
      <li><strong>xi</strong> = Each data point</li>
      <li><strong>μ</strong> = Population mean</li>
      <li><strong>N</strong> = Total number of data points</li>
    </ul>
  </div>

  <div class="scenario">
    <h3>📊 Interactive Dataset Explorer</h3>
    <p>Experiment with different datasets to see how standard deviation changes. Try adding outliers or changing the spread of data!</p>
  </div>

  <div class="control">
    <label for="datasetSelect">Choose a preset dataset:</label>
    <select id="datasetSelect" style="padding: 0.5rem; border-radius: 0.375rem; border: 1px solid var(--border-color); margin-bottom: 1rem;">
      <option value="normal">Normal Distribution (Low Std Dev)</option>
      <option value="wide">Wide Distribution (High Std Dev)</option>
      <option value="bimodal">Bimodal Distribution</option>
      <option value="outliers">Dataset with Outliers</option>
      <option value="custom">Custom Dataset</option>
    </select>
  </div>

  <div class="control" id="customControls" style="display: none;">
    <label for="customData">Enter your data (comma-separated numbers):</label>
    <input type="text" id="customData" placeholder="10, 12, 14, 16, 18, 20, 22" 
           style="width: 100%; padding: 0.5rem; border-radius: 0.375rem; border: 1px solid var(--border-color); margin-top: 0.5rem;">
  </div>

  <div class="control">
    <label for="binCount">Number of histogram bins: <span id="binValue">20</span></label>
    <input type="range" id="binCount" min="5" max="50" step="1" value="20" />
  </div>

  <div id="distributionPlot" style="width:100%;height:400px;"></div>
  <div id="deviationPlot" style="width:100%;height:300px;"></div>

  <div class="highlight">
    <h3>📋 Dataset Statistics</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
      <div class="card">
        <h4>Count</h4>
        <p id="countValue" style="font-size: 1.5rem; font-weight: 600; color: var(--primary-color);">0</p>
      </div>
      <div class="card">
        <h4>Mean (μ)</h4>
        <p id="meanValue" style="font-size: 1.5rem; font-weight: 600; color: var(--primary-color);">0</p>
      </div>
      <div class="card">
        <h4>Standard Deviation (σ)</h4>
        <p id="stdValue" style="font-size: 1.5rem; font-weight: 600; color: var(--primary-color);">0</p>
      </div>
      <div class="card">
        <h4>Variance (σ²)</h4>
        <p id="varianceValue" style="font-size: 1.5rem; font-weight: 600; color: var(--primary-color);">0</p>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>🔢 Step-by-Step Calculation</h3>
    <div id="calculationSteps">
      <div class="solution-step">
        <strong>Step 1: Calculate the mean (μ)</strong>
        <p id="step1"></p>
      </div>
      <div class="solution-step">
        <strong>Step 2: Find deviations from mean (xi - μ)</strong>
        <p id="step2"></p>
      </div>
      <div class="solution-step">
        <strong>Step 3: Square the deviations (xi - μ)²</strong>
        <p id="step3"></p>
      </div>
      <div class="solution-step">
        <strong>Step 4: Calculate variance (average of squared deviations)</strong>
        <p id="step4"></p>
      </div>
      <div class="solution-step">
        <strong>Step 5: Take square root to get standard deviation</strong>
        <p id="step5"></p>
      </div>
    </div>
  </div>

  <div class="scenario" style="background-color: var(--bg-secondary); border: 2px solid var(--info-color);">
    <h3>🧠 Intuitive Understanding</h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 1rem;">
      <div>
        <h4 style="color: var(--success-color);">Low Standard Deviation</h4>
        <ul>
          <li>Data points cluster around the mean</li>
          <li>More predictable outcomes</li>
          <li>Less variability</li>
          <li>Example: Manufacturing quality control</li>
        </ul>
      </div>
      <div>
        <h4 style="color: var(--warning-color);">High Standard Deviation</h4>
        <ul>
          <li>Data points spread widely</li>
          <li>More unpredictable outcomes</li>
          <li>Higher variability</li>
          <li>Example: Stock market returns</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>📈 Real-World Applications</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
      <div class="scenario">
        <h4>🏭 Quality Control</h4>
        <p>Manufacturing uses standard deviation to ensure product consistency. Lower σ means better quality control.</p>
      </div>
      <div class="scenario">
        <h4>📊 Finance</h4>
        <p>Investment risk is measured by standard deviation of returns. Higher σ indicates more volatile investments.</p>
      </div>
      <div class="scenario">
        <h4>🎯 Sports Analytics</h4>
        <p>Player consistency is measured by standard deviation of performance metrics. Lower σ means more reliable performance.</p>
      </div>
      <div class="scenario">
        <h4>🧪 Scientific Research</h4>
        <p>Measurement precision is evaluated using standard deviation. Lower σ indicates more precise instruments.</p>
      </div>
    </div>
  </div>

  <script>
    // Predefined datasets
    const datasets = {
      normal: [8, 9, 10, 10, 11, 11, 11, 12, 12, 12, 12, 13, 13, 13, 14, 14, 15, 16],
      wide: [2, 5, 8, 10, 12, 15, 18, 20, 22, 25, 28, 30, 32, 35, 38, 40, 42, 45],
      bimodal: [5, 6, 7, 8, 9, 10, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36],
      outliers: [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 50],
      custom: []
    };

    let currentData = datasets.normal;

    const datasetSelect = document.getElementById('datasetSelect');
    const customControls = document.getElementById('customControls');
    const customData = document.getElementById('customData');
    const binCount = document.getElementById('binCount');
    const binValue = document.getElementById('binValue');

    // Statistics display elements
    const countValue = document.getElementById('countValue');
    const meanValue = document.getElementById('meanValue');
    const stdValue = document.getElementById('stdValue');
    const varianceValue = document.getElementById('varianceValue');

    // Calculation steps elements
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');
    const step4 = document.getElementById('step4');
    const step5 = document.getElementById('step5');

    function calculateStatistics(data) {
      const n = data.length;
      const mean = data.reduce((sum, x) => sum + x, 0) / n;
      const deviations = data.map(x => x - mean);
      const squaredDeviations = deviations.map(d => d * d);
      const variance = squaredDeviations.reduce((sum, sq) => sum + sq, 0) / n;
      const stdDev = Math.sqrt(variance);

      return {
        count: n,
        mean: mean,
        deviations: deviations,
        squaredDeviations: squaredDeviations,
        variance: variance,
        standardDeviation: stdDev
      };
    }

    function updateDisplay() {
      if (currentData.length === 0) return;

      const stats = calculateStatistics(currentData);
      
      // Update statistics display
      countValue.textContent = stats.count;
      meanValue.textContent = stats.mean.toFixed(2);
      stdValue.textContent = stats.standardDeviation.toFixed(2);
      varianceValue.textContent = stats.variance.toFixed(2);

      // Update step-by-step calculation
      updateCalculationSteps(stats);

      // Update visualizations
      updateDistributionPlot();
      updateDeviationPlot(stats);
    }

    function updateCalculationSteps(stats) {
      const data = currentData;
      const mean = stats.mean;

      // Step 1: Mean calculation
      step1.innerHTML = `
        μ = (${data.join(' + ')}) / ${data.length}<br>
        μ = ${data.reduce((sum, x) => sum + x, 0)} / ${data.length} = ${mean.toFixed(2)}
      `;

      // Step 2: Deviations
      const deviationStrings = data.map((x, i) => `${x} - ${mean.toFixed(2)} = ${stats.deviations[i].toFixed(2)}`);
      step2.innerHTML = `
        Deviations: [${deviationStrings.join(', ')}]
      `;

      // Step 3: Squared deviations
      const squaredStrings = stats.deviations.map((d, i) => `(${d.toFixed(2)})² = ${stats.squaredDeviations[i].toFixed(2)}`);
      step3.innerHTML = `
        Squared deviations: [${squaredStrings.join(', ')}]
      `;

      // Step 4: Variance
      const sumSquared = stats.squaredDeviations.reduce((sum, sq) => sum + sq, 0);
      step4.innerHTML = `
        σ² = (${stats.squaredDeviations.map(sq => sq.toFixed(2)).join(' + ')}) / ${data.length}<br>
        σ² = ${sumSquared.toFixed(2)} / ${data.length} = ${stats.variance.toFixed(2)}
      `;

      // Step 5: Standard deviation
      step5.innerHTML = `
        σ = √${stats.variance.toFixed(2)} = ${stats.standardDeviation.toFixed(2)}
      `;
    }

    function updateDistributionPlot() {
      const bins = parseInt(binCount.value);
      
      const trace = {
        x: currentData,
        type: 'histogram',
        nbinsx: bins,
        name: 'Data Distribution',
        marker: {
          color: 'rgba(37, 99, 235, 0.7)',
          line: {
            color: 'rgba(37, 99, 235, 1)',
            width: 1
          }
        }
      };

      const stats = calculateStatistics(currentData);
      const meanLine = {
        x: [stats.mean, stats.mean],
        y: [0, Math.max(...currentData) * 0.1],
        mode: 'lines',
        name: `Mean (${stats.mean.toFixed(2)})`,
        line: {
          color: 'red',
          width: 3,
          dash: 'dash'
        }
      };

      // Add standard deviation bands
      const stdBands = [];
      for (let i = 1; i <= 2; i++) {
        const lower = stats.mean - i * stats.standardDeviation;
        const upper = stats.mean + i * stats.standardDeviation;
        
        stdBands.push({
          x: [lower, lower],
          y: [0, Math.max(...currentData) * 0.05],
          mode: 'lines',
          name: `${i}σ`,
          line: {
            color: i === 1 ? 'orange' : 'purple',
            width: 2,
            dash: 'dot'
          }
        });
        
        stdBands.push({
          x: [upper, upper],
          y: [0, Math.max(...currentData) * 0.05],
          mode: 'lines',
          showlegend: false,
          line: {
            color: i === 1 ? 'orange' : 'purple',
            width: 2,
            dash: 'dot'
          }
        });
      }

      const layout = {
        title: 'Data Distribution with Mean and Standard Deviation',
        xaxis: { title: 'Value' },
        yaxis: { title: 'Frequency' },
        showlegend: true,
        annotations: [
          {
            x: stats.mean,
            y: Math.max(...currentData) * 0.12,
            text: `μ = ${stats.mean.toFixed(2)}`,
            showarrow: true,
            arrowhead: 2,
            arrowcolor: 'red'
          },
          {
            x: stats.mean + stats.standardDeviation,
            y: Math.max(...currentData) * 0.08,
            text: `+1σ`,
            showarrow: false,
            font: { color: 'orange' }
          },
          {
            x: stats.mean - stats.standardDeviation,
            y: Math.max(...currentData) * 0.08,
            text: `-1σ`,
            showarrow: false,
            font: { color: 'orange' }
          }
        ]
      };

      Plotly.newPlot('distributionPlot', [trace, meanLine, ...stdBands], layout, { responsive: true });
    }

    function updateDeviationPlot(stats) {
      const indices = currentData.map((_, i) => i + 1);
      
      const deviationTrace = {
        x: indices,
        y: stats.deviations,
        type: 'bar',
        name: 'Deviations from Mean',
        marker: {
          color: stats.deviations.map(d => d >= 0 ? 'rgba(16, 185, 129, 0.7)' : 'rgba(239, 68, 68, 0.7)'),
          line: {
            color: stats.deviations.map(d => d >= 0 ? 'rgba(16, 185, 129, 1)' : 'rgba(239, 68, 68, 1)'),
            width: 1
          }
        }
      };

      const zeroLine = {
        x: [0, currentData.length + 1],
        y: [0, 0],
        mode: 'lines',
        name: 'Mean Line',
        line: {
          color: 'black',
          width: 2
        }
      };

      const layout = {
        title: 'Individual Deviations from Mean',
        xaxis: { title: 'Data Point Index' },
        yaxis: { title: 'Deviation from Mean' },
        showlegend: true
      };

      Plotly.newPlot('deviationPlot', [deviationTrace, zeroLine], layout, { responsive: true });
    }

    // Event listeners
    datasetSelect.addEventListener('change', function() {
      const selectedDataset = this.value;
      
      if (selectedDataset === 'custom') {
        customControls.style.display = 'block';
        customData.focus();
      } else {
        customControls.style.display = 'none';
        currentData = [...datasets[selectedDataset]];
        updateDisplay();
      }
    });

    customData.addEventListener('input', function() {
      if (datasetSelect.value === 'custom') {
        try {
          const input = this.value.trim();
          if (input) {
            currentData = input.split(',').map(x => parseFloat(x.trim())).filter(x => !isNaN(x));
            if (currentData.length > 0) {
              updateDisplay();
            }
          }
        } catch (e) {
          console.error('Invalid input:', e);
        }
      }
    });

    binCount.addEventListener('input', function() {
      binValue.textContent = this.value;
      updateDistributionPlot();
    });

    // Initialize
    updateDisplay();
  </script>
</body>
</html>